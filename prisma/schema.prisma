generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model or at least one of its fields has comments in the database, and requires an additional setup for migrations: Read more: https://pris.ly/d/database-comments
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
/// This model contains an expression index which requires additional setup for migrations. Visit https://pris.ly/d/expression-indexes for more info.
model users {
  id       String     @id @db.Uuid
  profiles profiles[]
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model laps {
  id               String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  session_id       String?            @db.Uuid
  lap_number       Int
  lap_time_seconds Decimal?           @db.Decimal(10, 3)
  max_lean_angle   Decimal?           @db.Decimal(5, 2)
  max_speed_kmh    Decimal?           @db.Decimal(6, 2)
  max_g_force_x    Decimal?           @db.Decimal(5, 3)
  max_g_force_z    Decimal?           @db.Decimal(5, 3)
  start_time       DateTime?          @db.Timestamptz(6)
  end_time         DateTime?          @db.Timestamptz(6)
  sector_1         Decimal?           @db.Decimal
  sector_2         Decimal?           @db.Decimal
  sector_3         Decimal?           @db.Decimal
  created_at       DateTime?          @default(now()) @db.Timestamptz(6)
  min_g_force_x    Decimal?           @db.Decimal(5, 3)
  min_g_force_z    Decimal?           @db.Decimal(5, 3)
  min_speed_kmh    Decimal?           @db.Decimal(6, 2)
  sessions         public_sessions?   @relation(fields: [session_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  telemetry_points telemetry_points[]

  @@index([lap_number], map: "idx_laps_lap_number")
  @@index([session_id], map: "idx_laps_session_id")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model profiles {
  id         String            @id @db.Uuid
  updated_at DateTime?         @db.Timestamptz(6)
  username   String?           @unique
  full_name  String?
  avatar_url String?
  users      users             @relation(fields: [id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  sessions   public_sessions[]
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model public_sessions {
  id                    String             @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  track_id              String?            @db.Uuid
  user_id               String?            @db.Uuid
  data_source           String?
  session_date          DateTime           @db.Timestamptz(6)
  session_type          String?            @default("Track")
  total_laps            Int?               @default(0)
  best_lap_time_seconds Decimal?           @db.Decimal(10, 3)
  vehicle               String?
  duration_seconds      Decimal?           @db.Decimal
  session_source        String?
  created_at            DateTime?          @default(now()) @db.Timestamptz(6)
  updated_at            DateTime?          @default(now()) @db.Timestamptz(6)
  laps                  laps[]
  tracks                tracks?            @relation(fields: [track_id], references: [id], onUpdate: NoAction)
  profiles              profiles?          @relation(fields: [user_id], references: [id], onDelete: NoAction)
  telemetry_points      telemetry_points[]

  @@index([session_date], map: "idx_sessions_session_date")
  @@index([track_id], map: "idx_sessions_track_id")
  @@map("sessions")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model telemetry_points {
  id            String           @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  session_id    String?          @db.Uuid
  lap_id        String?          @db.Uuid
  record_number Int
  timestamp     DateTime         @db.Timestamptz(6)
  altitude      Decimal?         @db.Decimal(8, 2)
  speed_kmh     Decimal?         @db.Decimal(6, 2)
  g_force_x     Decimal?         @db.Decimal(5, 3)
  g_force_z     Decimal?         @db.Decimal(5, 3)
  lap_number    Int?
  lean_angle    Decimal?         @db.Decimal(5, 2)
  gyro_x        Decimal?         @db.Decimal(8, 3)
  gyro_y        Decimal?         @db.Decimal(8, 3)
  gyro_z        Decimal?         @db.Decimal(8, 3)
  gps_point     Json?
  laps          laps?            @relation(fields: [lap_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  sessions      public_sessions? @relation(fields: [session_id], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@index([lap_id], map: "idx_telemetry_lap_id")
  @@index([session_id], map: "idx_telemetry_session_id")
  @@index([timestamp], map: "idx_telemetry_timestamp")
}

/// This model contains row level security and requires additional setup for migrations. Visit https://pris.ly/d/row-level-security for more info.
model tracks {
  id            String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name          String            @unique
  country       String?
  length_meters Decimal?          @db.Decimal(10, 2)
  turns         Int?
  configuration String?
  image_url     String?
  description   String?
  created_at    DateTime?         @default(now()) @db.Timestamptz(6)
  updated_at    DateTime?         @default(now()) @db.Timestamptz(6)
  gps_point     Json?
  sessions      public_sessions[]
}
